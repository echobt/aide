#!/bin/bash
set -e

if [ "${SKIP_GIT_HOOKS:-0}" = "1" ]; then
  echo "[githook:pre-commit] Skipping (SKIP_GIT_HOOKS=1)"
  exit 0
fi

echo "[githook:pre-commit] Running pre-commit checks..."

# Rust formatting
if command -v cargo >/dev/null 2>&1; then
  echo "[githook:pre-commit] Checking Rust formatting..."
  (cd src-tauri && cargo fmt --all -- --check) || {
    echo "[githook:pre-commit] Rust formatting failed. Run: cd src-tauri && cargo fmt --all"
    exit 1
  }
fi

# TypeScript type checking
if command -v npx >/dev/null 2>&1 && [ -f "tsconfig.json" ]; then
  echo "[githook:pre-commit] Checking TypeScript types..."
  npm run typecheck || {
    echo "[githook:pre-commit] TypeScript type check failed."
    exit 1
  }
fi

echo "[githook:pre-commit] pre-commit checks passed."
