/* =============================================================================
   NOTIFICATIONS SYSTEM - JetBrains UI Tokens Implementation
   Converted to use JetBrains design tokens
   ============================================================================= */

/* =============================================================================
   1. CSS CUSTOM PROPERTIES (DESIGN TOKENS)
   ============================================================================= */
:root {
  /* Background Colors */
  --notification-background: var(--jb-popup);
  --notification-foreground: var(--jb-text-body-color);
  --notification-border: var(--jb-border-divider);
  
  /* Severity Icon Colors */
  --notification-error-icon: var(--cortex-error);
  --notification-warning-icon: var(--cortex-warning);
  --notification-info-icon: var(--jb-border-focus);
  --notification-success-icon: var(--cortex-success);
  
  /* Link Colors */
  --notification-link: var(--jb-border-focus);
  
  /* Notifications Center Specific */
  --notification-center-header-foreground: var(--jb-text-muted-color);
  --notification-center-header-background: var(--jb-popup);
  --notification-center-border: var(--jb-border-divider);
  
  /* Toast Specific */
  --notification-toast-border: var(--jb-border-divider);
  --notification-shadow: var(--jb-shadow-popup);
  
  /* Focus Border */
  --notification-focus-border: var(--jb-border-focus);
  
  /* Contrast Border (high contrast mode) */
  --notification-contrast-border: transparent;
}

/* =============================================================================
   2. TOAST CONTAINER (positioned in ToastContext)
   Positioned bottom-right corner, 30px above status bar, 16px from right
   ============================================================================= */
.notifications-toasts {
  position: fixed;
  z-index: 1000;
  right: 16px;
  bottom: 30px; /* Above status bar */
  display: flex;
  flex-direction: column;
  gap: 8px; /* Stack multiple notifications */
  overflow: hidden;
  pointer-events: none;
}

.notifications-toasts.nostatusbar {
  bottom: 16px;
}

/* =============================================================================
   3. INDIVIDUAL TOAST
   350px width with JetBrains styling
   ============================================================================= */
.notification-toast-container {
  overflow: hidden;
  pointer-events: auto;
}

.notification-toast {
  position: relative;
  width: 350px;
  max-width: calc(100vw - 32px);
  border-radius: var(--jb-radius-lg);
  background: var(--jb-popup);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  color: var(--jb-text-body-color);
  border: 1px solid var(--jb-border-divider);
  box-shadow: var(--jb-shadow-popup);
  overflow: hidden;
  /* Fix for subpixel rendering artifacts on rounded corners with backdrop-filter */
  isolation: isolate;
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  
  /* Animation - fade only, no slide */
  transform: translateX(0);
  opacity: 0;
  transition: opacity 200ms ease-out;
}

/* Appearance without movement - fade in only */
.notification-toast.notification-fade-in {
  opacity: 1;
  transform: translateX(0);
}

/* Post-animation stable state */
.notification-toast.notification-fade-in-done {
  opacity: 1;
  transform: translateX(0);
  transition: none;
}

/* Fade out static */
.notification-toast.notification-fade-out {
  opacity: 0;
  transform: translateX(0);
  transition: opacity 200ms ease-out;
}

/* Reduced motion support */
.reduce-motion .notification-toast {
  transition: transform 0ms ease-out, opacity 0ms ease-out;
}

/* =============================================================================
   4. NOTIFICATION LIST ITEM (shared between toast and center)
   10px 14px padding
   ============================================================================= */
.notification-list-item {
  display: flex;
  flex-direction: column-reverse; /* Details row first for keyboard access */
  padding: 10px 14px;
  height: 100%;
  box-sizing: border-box;
  min-height: 42px; /* ROW_HEIGHT */
}

.notification-list-item-main-row {
  display: flex;
  flex-grow: 1;
  align-items: flex-start;
}

/* =============================================================================
   5. NOTIFICATION ICON
   22px icon size
   ============================================================================= */
.notification-list-item-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  flex: 0 0 22px;
  width: 22px;
  height: 22px;
  margin-right: 10px;
  font-size: var(--jb-font-size-lg);
  flex-shrink: 0;
}

/* Severity icon colors */
.notification-list-item-icon.codicon-error,
.notification-list-item-icon--error,
.notification-icon.error {
  color: var(--cortex-error) !important;
}

.notification-list-item-icon.codicon-warning,
.notification-list-item-icon--warning,
.notification-icon.warning {
  color: var(--cortex-warning) !important;
}

.notification-list-item-icon.codicon-info,
.notification-list-item-icon--info,
.notification-icon.info {
  color: var(--jb-border-focus) !important;
}

.notification-list-item-icon--success,
.notification-icon.success {
  color: var(--cortex-success) !important;
}

/* =============================================================================
   6. MESSAGE CONTAINER
   ============================================================================= */
.notification-list-item-message {
  line-height: 22px; /* LINE_HEIGHT */
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1;
  user-select: text;
  -webkit-user-select: text;
  white-space: nowrap;
  font-size: var(--jb-font-size-base);
}

/* Expanded state */
.notification-list-item.expanded .notification-list-item-message {
  white-space: normal;
  word-wrap: break-word;
}

/* Links in message */
.notification-list-item-message a {
  color: var(--jb-border-focus);
  text-decoration: none;
}

.notification-list-item-message a:hover {
  text-decoration: underline;
}

.notification-list-item-message a:focus {
  outline-width: 1px;
  outline-style: solid;
  outline-color: var(--jb-border-focus);
}

/* =============================================================================
   7. DETAILS ROW (source + buttons)
   ============================================================================= */
.notification-list-item-details-row {
  display: none;
  align-items: center;
  padding-left: 5px;
  overflow: hidden;
  margin-top: 4px;
}

.notification-list-item.expanded .notification-list-item-details-row {
  display: flex;
}

.notification-list-item-source {
  flex: 1;
  font-size: var(--jb-font-size-sm);
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--jb-text-muted-color);
}

/* =============================================================================
   8. ACTION BUTTONS
   2px 8px padding, 12px font-size, 2px border-radius
   ============================================================================= */
.notification-list-item-buttons-container,
.notification-actions {
  display: flex;
  overflow: hidden;
  gap: 8px;
  margin-top: 8px;
}

.notification-list-item-buttons-container .monaco-button,
.notification-list-item-buttons-container .notification-button,
.notification-action {
  width: fit-content;
  padding: 2px 8px;
  display: inline-block;
  font-size: var(--jb-font-size-sm);
  overflow: hidden;
  text-overflow: ellipsis;
  outline-offset: 2px !important;
  border-radius: var(--jb-radius-sm, 2px);
  border: none;
  cursor: pointer;
  background: var(--jb-button-secondary-bg, var(--jb-popup));
  color: var(--jb-text-body-color);
  transition: background 0.1s ease;
}

.notification-list-item-buttons-container .monaco-button:hover,
.notification-list-item-buttons-container .notification-button:hover,
.notification-action:hover {
  background: var(--jb-button-secondary-hover-bg, var(--jb-popup));
}

.notification-list-item-buttons-container .monaco-button.primary,
.notification-list-item-buttons-container .notification-button.primary,
.notification-action.primary {
  background: var(--jb-button-primary-bg);
  color: var(--jb-button-primary-fg, white);
}

.notification-list-item-buttons-container .monaco-button.primary:hover,
.notification-list-item-buttons-container .notification-button.primary:hover,
.notification-action.primary:hover {
  background: var(--jb-button-primary-hover-bg);
}

/* =============================================================================
   9. TOOLBAR (close, expand, etc.)
   ============================================================================= */
.notification-list-item-toolbar-container {
  display: none;
  height: 22px;
  flex-shrink: 0;
}

/* Show toolbar on interaction */
.notification-list-item:hover .notification-list-item-toolbar-container,
.notification-list-item.focused .notification-list-item-toolbar-container,
.notification-list-item.expanded .notification-list-item-toolbar-container {
  display: flex;
}

.notification-list-item-toolbar-container .action-item {
  margin-right: 4px;
}

.notification-list-item-toolbar-container .action-item:first-child {
  margin-left: 4px;
}

/* =============================================================================
   10. NOTIFICATIONS CENTER
   ============================================================================= */
.notifications-center {
  position: absolute;
  z-index: 1000;
  right: 7px;
  bottom: 29px; /* 22px status bar + 7px offset */
  display: none;
  overflow: hidden;
  border-radius: var(--jb-radius-lg);
  max-width: 450px;
  max-height: 400px;
  background: var(--jb-popup);
  border: 1px solid var(--jb-border-divider);
  box-shadow: var(--jb-shadow-popup);
}

.notifications-center.visible {
  display: block;
}

.notifications-center.nostatusbar {
  bottom: 11px;
}

/* =============================================================================
   11. NOTIFICATIONS CENTER HEADER
   ============================================================================= */
.notifications-center-header {
  display: flex;
  align-items: center;
  padding-left: 8px;
  padding-right: 5px;
  height: 35px;
  background: var(--jb-popup);
  border-bottom: 1px solid var(--jb-border-divider);
}

.notifications-center-header-title {
  text-transform: uppercase;
  font-size: var(--jb-font-size-xs);
  font-weight: 600;
  color: var(--jb-text-muted-color);
  letter-spacing: 0.04em;
}

.notifications-center-header-toolbar {
  flex: 1;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 2px;
}

.notifications-center-header-toolbar .action-item {
  padding: 4px;
  border-radius: var(--jb-radius-sm, 4px);
  cursor: pointer;
  color: var(--jb-text-muted-color);
  transition: background 0.1s ease;
}

.notifications-center-header-toolbar .action-item:hover {
  background: var(--jb-button-secondary-hover-bg, var(--jb-popup));
  color: var(--jb-text-body-color);
}

/* =============================================================================
   12. NOTIFICATIONS LIST CONTAINER
   ============================================================================= */
.notifications-list-container {
  color: var(--jb-text-body-color);
  background: var(--jb-popup);
  outline-color: var(--notification-contrast-border);
  overflow-y: auto;
  max-height: calc(400px - 35px); /* max-height - header */
}

/* Inter-notification border */
.notifications-list-container .notification-list-item:not(:last-child) {
  border-bottom: 1px solid var(--jb-border-divider);
}

/* Last notification rounded corners */
.notifications-list-container .notification-list-item:last-child {
  border-radius: 0px 0px var(--jb-radius-lg) var(--jb-radius-lg);
}

/* =============================================================================
   13. PROGRESS BAR
   2px height with accent color
   ============================================================================= */
.notification-progress,
.notification-list-item .progress-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--jb-popup);
  overflow: hidden;
}

.notification-progress-inner,
.notification-list-item .progress-bar-inner {
  height: 100%;
  background: var(--jb-border-focus);
  transition: width 50ms linear;
}

/* Indeterminate progress animation for long-running operations */
.notification-progress.indeterminate,
.notification-progress.indeterminate .notification-progress-inner {
  animation: progress-indeterminate 2s infinite linear;
}

@keyframes progress-indeterminate {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* =============================================================================
   14. CLOSE BUTTON
   22x22px, 3px border-radius, hidden by default, visible on hover
   ============================================================================= */
.notification-close-button {
  position: absolute;
  top: 8px;
  right: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border: none;
  background: transparent;
  cursor: pointer;
  color: var(--jb-text-muted-color);
  border-radius: var(--jb-radius-sm, 3px);
  transition: background 100ms ease, opacity 100ms ease;
  opacity: 0;
  flex-shrink: 0;
}

.notification-list-item:hover .notification-close-button,
.notification-toast:hover .notification-close-button {
  opacity: 1;
}

.notification-close-button:hover {
  background: var(--jb-button-secondary-hover-bg, var(--jb-popup));
  color: var(--jb-text-body-color);
}

/* Non-absolute positioned close buttons for notification center list */
.notification-list-item .notification-close-button {
  position: static;
  margin-left: 4px;
}

/* =============================================================================
   15. EMPTY STATE
   ============================================================================= */
.notifications-center-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  color: var(--jb-text-muted-color);
}

.notifications-center-empty-icon {
  font-size: var(--jb-font-size-xxl, 48px);
  margin-bottom: 16px;
  opacity: 0.5;
}

.notifications-center-empty-text {
  font-size: var(--jb-font-size-base);
  text-align: center;
}

/* =============================================================================
   16. SCROLLBAR STYLING
   ============================================================================= */
.notifications-list-container::-webkit-scrollbar {
  width: 10px;
}

.notifications-list-container::-webkit-scrollbar-track {
  background: transparent;
}

.notifications-list-container::-webkit-scrollbar-thumb {
  background: var(--jb-scrollbar-thumb, rgba(121, 121, 121, 0.4));
  border-radius: 5px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

.notifications-list-container::-webkit-scrollbar-thumb:hover {
  background: var(--jb-scrollbar-thumb-hover, rgba(100, 100, 100, 0.7));
  background-clip: padding-box;
}

/* =============================================================================
   17. BADGE (unread count)
   ============================================================================= */
.notifications-badge {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.notifications-badge-count {
  position: absolute;
  top: -2px;
  right: -2px;
  min-width: 16px;
  height: 16px;
  padding: 0 4px;
  font-size: var(--jb-font-size-xs);
  font-weight: 600;
  line-height: 16px;
  text-align: center;
  background: var(--jb-border-focus);
  color: white;
  border-radius: var(--jb-radius-full, 8px);
}

/* =============================================================================
   18. ANIMATION KEYFRAMES
   Static animations - fade only
   ============================================================================= */
@keyframes notification-slide-in {
  from {
    opacity: 0;
    transform: translateX(0);  /* No movement */
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes notification-slide-out {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(0);  /* No movement */
  }
}

/* Notification enter animation class */
.notification-enter {
  animation: notification-slide-in 200ms ease-out;
}

/* =============================================================================
   19. NOTIFICATION STACK (Multiple notifications)
   8px gap between notifications
   ============================================================================= */
.notification-stack {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* =============================================================================
   20. FOCUS STATES (Accessibility)
   ============================================================================= */
.notification-list-item:focus-visible {
  outline: 1px solid var(--jb-border-focus);
  outline-offset: -1px;
}

.notification-button:focus-visible,
.notification-close-button:focus-visible {
  outline: 1px solid var(--jb-border-focus);
  outline-offset: 2px;
}

/* =============================================================================
   21. NOTIFICATION CENTER PANEL (Modern VS Code-style)
   ============================================================================= */

.notification-center-panel {
  position: fixed;
  right: 16px;
  bottom: 30px;
  z-index: var(--cortex-z-notifications, 1000);
  width: 380px;
  max-width: calc(100vw - 32px);
  max-height: 450px;
  background: var(--jb-popup);
  border: 1px solid var(--jb-border-default);
  border-radius: var(--jb-radius-lg);
  box-shadow: var(--jb-shadow-popup);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.notification-center-panel[data-state="closed"] {
  display: none;
}

/* =============================================================================
   22. DO NOT DISTURB BANNER
   ============================================================================= */

.notification-dnd-banner {
  display: flex;
  align-items: center;
  gap: var(--cortex-space-md, 8px);
  padding: var(--cortex-space-sm, 4px) var(--cortex-space-lg, 12px);
  background: rgba(245, 158, 11, 0.15);
  border-bottom: 1px solid var(--jb-border-divider);
  flex-shrink: 0;
}

.notification-dnd-banner-icon {
  width: 14px;
  height: 14px;
  color: var(--cortex-warning);
}

/* =============================================================================
   23. NOTIFICATION UNREAD INDICATOR
   ============================================================================= */

.notification-unread-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--jb-border-focus);
  flex-shrink: 0;
}

/* =============================================================================
   24. NOTIFICATION GROUP HEADER
   ============================================================================= */

.notification-group-header {
  padding: var(--cortex-space-sm, 4px) var(--cortex-space-lg, 12px);
  background: var(--jb-panel);
  border-bottom: 1px solid var(--jb-border-divider);
}

.notification-group-title {
  font-size: var(--jb-font-size-xs, 10px);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--jb-text-muted-color);
}

/* =============================================================================
   25. TOAST PROGRESS INDICATOR
   ============================================================================= */

.toast-progress-container {
  margin-top: var(--cortex-space-md, 8px);
  height: 4px;
  background: var(--jb-surface-hover);
  border-radius: 2px;
  overflow: hidden;
}

.toast-progress-bar {
  height: 100%;
  background: var(--jb-border-focus);
  border-radius: 2px;
  transition: width 150ms ease;
}

.toast-progress-text {
  margin-top: var(--cortex-space-xs, 2px);
  font-size: var(--jb-font-size-xs, 10px);
  color: var(--jb-text-muted-color);
}

/* =============================================================================
   26. NOTIFICATION TIMESTAMPS
   ============================================================================= */

.notification-timestamp {
  font-size: var(--jb-font-size-xs, 10px);
  color: var(--jb-text-muted-color);
  white-space: nowrap;
}
